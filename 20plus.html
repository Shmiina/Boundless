<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>20+ Hours Players</title>
<style>
:root{
  --bg:#0d1117; --card:#0f1720; --muted:#9aa4b2; --accent:#58a6ff; --accent-2:#1f6feb;
  --glass: rgba(255,255,255,0.03); --text:#e6edf3; --border: rgba(255,255,255,0.08);
}
[data-theme="light"]{
  --bg:#f5f7fa; --card:#ffffff; --muted:#5b6b78; --accent:#1a73e8; --accent-2:#1558b8;
  --glass: rgba(0,0,0,0.03); --text:#1a1a1a; --border: rgba(0,0,0,0.08);
}

body{
  margin:0;
  font-family:Inter, sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:16px;
}

.app{
  width:100%;
  max-width:760px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

.card{
  background:var(--card);
  padding:16px;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.player{
  display:flex;
  justify-content:space-between;
  padding:10px;
  border-radius:10px;
  background:var(--glass);
  color:var(--text);
  border:1px solid var(--border);
}

.button{
  padding:8px 14px;
  border-radius:10px;
  border:none;
  background:var(--accent);
  color:#fff;
  cursor:pointer;
  font-weight:600;
}
.button:hover{background:var(--accent-2);}

a.link-button{
  padding:8px 12px;
  border-radius:10px;
  background:var(--card);
  color:var(--text);
  text-decoration:none;
  border:1px solid var(--border);
}

.pagination{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:20px;
}

@media(max-width:600px){
  .topbar{flex-direction:column;}
}
</style>
</head>
<body>
<div class="app">

  <!-- Topbar -->
  <div class="topbar" style="display:flex;justify-content:space-between;align-items:center;">
    <a href="index.html" class="link-button">← Back to Main</a>
    <select id="themeSelect" class="theme-select">
      <option value="auto">Auto</option>
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>
  </div>

  <!-- Leaderboard Card -->
  <div class="card">
    <h2>Players with 20+ Hours</h2>
    <div id="list" class="leaderboard"></div>
    <div class="pagination">
      <button id="prevPage" class="button">Prev</button>
      <span id="pageIndicator" style="font-weight:600;color:var(--muted)">Page 1</span>
      <button id="nextPage" class="button">Next</button>
    </div>
  </div>

</div>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbwOtTP8TgoM6URjfUNLqK0962-wRAP4IDHlKQApNvpov6dH7A7fxmrKSZ45hg_mKGBIaA/exec";
let cachedData = [], page = 1, pageSize = 20;

// Theme toggle
let themeMode = localStorage.getItem('ph_theme') || 'auto';
function applyTheme(mode){
  document.documentElement.setAttribute('data-theme',
    mode==='auto'? (window.matchMedia('(prefers-color-scheme: light)').matches?'light':'dark') : mode
  );
}
applyTheme(themeMode);
document.getElementById('themeSelect').value = themeMode;
document.getElementById('themeSelect').addEventListener('change', e=>{
  themeMode = e.target.value;
  localStorage.setItem('ph_theme', themeMode);
  applyTheme(themeMode);
});

// Number format
function numberFmt(n){ return (Number(n)||0).toFixed(2); }

// Fetch + cache
async function fetchData(){
  if(cachedData.length) return cachedData;
  const chars=['Nami','Pia','FREDDIE'];
  const reqs=chars.map(c=>fetch(apiUrl+'?leaderboard='+c).then(r=>r.json()).catch(()=>[]));
  const res=await Promise.all(reqs);
  const flat=res.flatMap((arr,i)=>(arr||[]).map(p=>({id:p.id,name:p.name,hours:Number(p.hours),character:chars[i]})));
  const map=new Map();
  flat.forEach(p=>{if(!map.has(p.id)||p.hours>map.get(p.id).hours) map.set(p.id,p)});
  cachedData=[...map.values()].filter(p=>p.hours>=20).sort((a,b)=>b.hours-a.hours);
  return cachedData;
}

// Render page
async function renderPage(){
  const list = await fetchData();
  const start = (page-1)*pageSize;
  const slice = list.slice(start, start+pageSize);
  
  document.getElementById('list').innerHTML = slice.map((p, i) => `
    <div class="player" style="display:flex;align-items:center;">
      <div style="width:30px;text-align:right;margin-right:10px;font-weight:600;color:var(--muted)">
        ${start + i + 1}.
      </div>
      <div style="flex:1">
        ${p.name}<br><span style="font-size:12px;color:var(--muted)">ID: ${p.id} • ${p.character}</span>
      </div>
      <div>${numberFmt(p.hours)} hrs</div>
    </div>
  `).join('');

  document.getElementById('prevPage').disabled = page===1;
  document.getElementById('nextPage').disabled = page*pageSize>=list.length;
  document.getElementById('pageIndicator').textContent = `Page ${page}`;
}


// Pagination events
document.getElementById('prevPage').addEventListener('click',()=>{page--; renderPage();});
document.getElementById('nextPage').addEventListener('click',()=>{page++; renderPage();});

// Initial render
renderPage();
</script>
</body>
</html>
