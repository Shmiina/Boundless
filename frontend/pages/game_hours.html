<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <title>Aggregated Game Time by Tier</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1 { color: #333; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
        /* Style for the Tier Headings */
        h2 { color: #007bff; margin-top: 30px; border-bottom: 1px solid #ddd; padding-bottom: 5px;}
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; }
        tr:hover { background-color: #f1f1f1; }
        .hours { font-weight: bold; text-align: right; }
    </style>
</head>
<body>
    <div id="game-data-container">
        <h1>ðŸŽ® Aggregated Game Time Report</h1>
        <h2>Fetching latest data...</h2>
    </div>

    <script>
        // *** REPLACE WITH YOUR ACTUAL DEPLOYED WEB APP URL ***
        const WEB_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx0RGffOaH_8DgwrwektyUcyEptPt_cGhKWt7OeTKMhvJINeRqYNtBJXeUaB_BRZrXj/exec'; 
        
        // This must match the TARGET_TIERS in the Google Script
        const TARGET_TIERS = ['Tier 1.2', 'Tier 2.1.1', 'Tier 2.1.2', 'Tier 2.2', 'Tier 3'];

        // 1. JSONP Callback function (Google Script calls this with the grouped data)
        function handleGameTime(groupedData) {
            const container = document.getElementById('game-data-container');
            let htmlContent = '<h1>ðŸŽ® Aggregated Game Time Report</h1>';
            let dataFound = false;

            // Function to generate the HTML table for a given list of games
            const generateTable = (tierName, games) => {
                let tableHtml = `<h2>${tierName}</h2>`;
                tableHtml += `
                    <table>
                        <thead>
                            <tr>
                                <th>Game Title</th>
                                <th style="text-align: right;">Total Hours Rendered</th>
                            </tr>
                        </thead>
                        <tbody>`;
                
                games.forEach(game => {
                    tableHtml += `
                        <tr>
                            <td>${game.gameTitle}</td>
                            <td class="hours">${game.totalHours}</td>
                        </tr>`;
                });

                tableHtml += `</tbody></table>`;
                return tableHtml;
            };

            // Loop through the required tiers and generate a table for each
            TARGET_TIERS.forEach(tier => {
                const games = groupedData[tier];
                
                if (games && games.length > 0) {
                    dataFound = true;
                    htmlContent += generateTable(tier, games);
                }
            });
            
            // Check for 'Other' games (e.g., Tier 1 games)
            if (groupedData['Other'] && groupedData['Other'].length > 0) {
                dataFound = true;
                htmlContent += generateTable('Other Tiers (e.g., Tier 1, Uncategorized)', groupedData['Other']);
            }

            if (!dataFound) {
                htmlContent += '<p>No game data found for the specified tiers.</p>';
            }

            container.innerHTML = htmlContent;
        }

        // 2. Function to dynamically create a script tag to load the data (JSONP)
        function loadGameDataJSONP() {
            const script = document.createElement('script');
            // The callback name MUST match the function name (handleGameTime)
            script.src = WEB_SCRIPT_URL + '?callback=handleGameTime'; 
            
            document.head.appendChild(script);
            
            script.onerror = function() {
                document.getElementById('game-data-container').innerHTML = 
                    '<p style="color: red;">Failed to load data using JSONP. Please check the Web App URL and script.</p>';
            }
        }

        // 3. Call the JSONP function when the page loads
        window.onload = loadGameDataJSONP;
    </script>
</body>
</html>