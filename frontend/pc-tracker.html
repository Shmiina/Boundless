<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PC Tracker</title>

<style>
:root {
  --bg:#0d1117;
  --card:#161b22;
  --text:#e6edf3;
  --muted:#8b949e;
  --glass:rgba(255,255,255,0.05);
  --blue:#1f6feb;
  --blue-hover:#388bfd;
}
[data-theme="light"] {
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#1a1a1a;
  --muted:#6b7280;
  --glass:rgba(0,0,0,0.05);
  --blue:#1a73e8;
  --blue-hover:#185ec4;
}
body {
  margin:0;
  font-family:Inter, sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:20px;
  display:flex;
  justify-content:center;
}
.container {
  width:100%;
  max-width:920px;
}
h2 {
  margin-top:0;
}
.top-buttons {
  display:flex;
  gap:10px;
  margin-bottom:16px;
  flex-wrap:wrap;
}
.navbtn {
  background:var(--blue);
  border:none;
  color:white;
  padding:10px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
.navbtn:hover { background:var(--blue-hover); }

.pc-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap:14px;
}
.pc-card {
  background:var(--card);
  padding:14px;
  border-radius:10px;
  border:1px solid var(--glass);
}
.pc-card h3 {
  margin:0 0 6px 0;
}
.small {
  color:var(--muted);
  font-size:13px;
}
.btn-row {
  margin-top:8px;
}
.action {
  background:var(--blue);
  border:none;
  padding:6px 10px;
  color:white;
  border-radius:6px;
  cursor:pointer;
  margin-right:6px;
  font-size:14px;
}
.action:hover {
  background:var(--blue-hover);
}
</style>
</head>

<body>
<div class="container">

  <div class="top-buttons">
    <button class="navbtn" onclick="window.location.href='index.html'">üèÜ Leaderboard</button>
    <button class="navbtn" onclick="window.location.href='20plus.html'">‚è≥ 20+ Hours</button>
    <button class="navbtn" onclick="window.location.href='yesterday-report.html'">üìÑ Yesterday Report</button>
  </div>

  <h2>PC Occupancy Tracker</h2>
  <div id="pcGrid" class="pc-grid">Loading...</div>

</div>

<script>
// =======================================================
// CONFIG
// =======================================================
const BACKEND = "https://boundless-backend-vo5t.onrender.com"; // CHANGE THIS
const WS_URL = BACKEND.replace("https://", "wss://");

// =======================================================
// THEME AUTO
// =======================================================
(function(){
  const prefersLight = window.matchMedia("(prefers-color-scheme: light)").matches;
  document.documentElement.setAttribute("data-theme", prefersLight ? "light" : "dark");
})();

// =======================================================
// LOAD PCs
// =======================================================
async function loadPCs() {
  try {
    const res = await fetch(`${BACKEND}/pcs`);
    const pcs = await res.json();
    renderPCs(pcs);
  } catch (err) {
    pcGrid.innerHTML = "<p style='color:red'>Failed to load.</p>";
  }
}

function renderPCs(pcs){
  const grid = document.getElementById("pcGrid");
  grid.innerHTML = "";

  pcs.forEach(pc => {
    const card = document.createElement("div");
    card.className = "pc-card";

    card.innerHTML = `
      <h3>${pc.name}</h3>
      <div>Status: <b>${pc.status}</b></div>
      <div class="small">By: ${pc.updated_by || "‚Äî"}</div>
      <div class="small">At: ${pc.updated_at ? new Date(pc.updated_at).toLocaleString() : "‚Äî"}</div>
      <div class="small">Uptime: ${pc.total_uptime.toFixed(2)} hrs</div>
      <div class="small">Downtime: ${pc.total_downtime.toFixed(2)} hrs</div>

      <div class="btn-row">
        <button class="action" onclick="updatePC('${pc.name}','occupied')">Occupied</button>
        <button class="action" onclick="updatePC('${pc.name}','free')">Free</button>
      </div>
    `;

    grid.appendChild(card);
  });
}

async function updatePC(name, status){
  let updatedBy = null;

  if (status === "occupied") {
    updatedBy = prompt("Enter your name:");
  }

  await fetch(`${BACKEND}/update`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ pc:name, status, updatedBy })
  });
}

// =======================================================
// WebSocket for Live Updates
// =======================================================
const ws = new WebSocket(WS_URL);
ws.onmessage = (ev) => {
  const msg = JSON.parse(ev.data);
  if (msg.type === "state") {
    renderPCs(msg.data);
  }
};

loadPCs();
</script>

</body>
</html>
