<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PC Tracker</title>
<style>
:root {
  --bg:#0d1117;
  --card:#0f1720;
  --muted:#9aa4b2;
  --accent:#58a6ff;
  --accent-2:#1f6feb;
  --glass: rgba(255,255,255,0.03);
  --text:#e6edf3;
}
[data-theme="light"] {
  --bg:#f5f7fa;
  --card:#ffffff;
  --muted:#5b6b78;
  --accent:#1a73e8;
  --accent-2:#1558b8;
  --glass: rgba(0,0,0,0.03);
  --text:#1a1a1a;
}
body {
  margin:0;
  font-family:Inter,sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:16px;
}
.app {
  width:100%;
  max-width:960px;
  display:flex;
  flex-direction:column;
  gap:16px;
}
.card {
  background:var(--card);
  padding:14px;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
h3 { margin:0; margin-bottom:10px; }
.pcs-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
  gap:12px;
}
.pc-card {
  background:var(--card);
  border:1px solid var(--glass);
  padding:12px;
  border-radius:8px;
}
.pc-title { font-size:18px; font-weight:600; margin-bottom:6px; }
.pc-status { font-size:14px; margin-bottom:6px; }
.btn {
  padding:6px 10px;
  border:none;
  background:var(--accent);
  color:#fff;
  border-radius:4px;
  cursor:pointer;
  font-size:14px;
  margin-right:6px;
}
.btn:hover { background: var(--accent-2); }

.top-buttons {
  display:flex;
  gap:10px;
  margin-bottom:12px;
  flex-wrap: wrap;
}
</style>
</head>
<body>
<div class="app">

  <div class="card">
    <h3>PC Occupancy Tracker</h3>
    <div class="top-buttons">
      <button class="btn" id="btnYesterday">Yesterday's Report</button>
      <button class="btn" id="btnReset">Reset Today</button>
      <button class="btn" onclick="window.location.href='index.html'">Leaderboard</button>
      <button class="btn" onclick="window.location.href='20plus.html'">Top 20+ Hours</button>
    </div>
    <div id="pcs" class="pcs-grid">Loading...</div>
  </div>

</div>

<script>
const HTTP_BASE = "https://boundless-backend-vo5t.onrender.com"; // Replace with your Railway backend
const pcsContainer = document.getElementById("pcs");

// Render PCs
function renderPCs(pcs) {
  pcsContainer.innerHTML = '';
  Object.keys(pcs).forEach(pcName => {
    const pc = pcs[pcName];
    const card = document.createElement('div');
    card.className = 'pc-card';
    card.innerHTML = `
      <div class="pc-title">${pcName}</div>
      <div class="pc-status"><b>Status:</b> ${pc.status}</div>
      <div><b>By:</b> ${pc.updatedBy || '—'}</div>
      <div><b>At:</b> ${pc.updatedAt ? new Date(pc.updatedAt).toLocaleString() : '—'}</div>
      <div><b>Uptime:</b> ${pc.totalUptime.toFixed(2)} hrs</div>
      <div><b>Downtime:</b> ${pc.totalDowntime.toFixed(2)} hrs</div>
      <div style="margin-top:6px;">
        <button class="btn" onclick="updatePC('${pcName}','occupied')">Occupied</button>
        <button class="btn" onclick="updatePC('${pcName}','free')">Free</button>
      </div>
    `;
    pcsContainer.appendChild(card);
  });
}

// Load initial PC state
async function loadPCs() {
  try {
    const res = await fetch(`${HTTP_BASE}/pcs`);
    const data = await res.json();
    renderPCs(data);
  } catch(err) {
    pcsContainer.innerHTML = "<p style='color:red'>Failed to load PC data.</p>";
    console.error(err);
  }
}

// Update PC status
async function updatePC(pc, status) {
  const name = status === 'free' ? null : prompt("Your name (optional):","");
  try {
    await fetch(`${HTTP_BASE}/update`, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ pc, status, updatedBy: name })
    });
    loadPCs();
  } catch(err){
    console.error(err);
    alert("Failed to update PC");
  }
}

// Yesterday's report
document.getElementById('btnYesterday').addEventListener('click', async () => {
  try {
    const res = await fetch(`${HTTP_BASE}/report?day=yesterday`);
    const report = await res.json();
    let msg = '';
    Object.keys(report).forEach(pc => {
      msg += `${pc}: Uptime ${report[pc].totalUptime} hrs | Downtime ${report[pc].totalDowntime} hrs\n`;
    });
    alert(msg || 'No data for yesterday');
  } catch(err){
    console.error(err);
    alert('Failed to fetch yesterday report');
  }
});

// Reset button
document.getElementById('btnReset').addEventListener('click', async () => {
  if(confirm("Are you sure you want to reset all PCs for today?")) {
    try {
      await fetch(`${HTTP_BASE}/reset`, { method:"POST" });
      loadPCs();
      alert("PCs reset successfully");
    } catch(err){
      console.error(err);
      alert("Failed to reset PCs");
    }
  }
});

loadPCs();
</script>
</body>
</html>
