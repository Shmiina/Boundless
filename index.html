<!-- Updated index.html (Real-time search only, theme on top right, mobile responsive) -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Player Hours — Leaderboard</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0d1117">
<link rel="icon" href="/icon-192.png">
<style>
:root{
  --bg:#0d1117; --card:#0f1720; --muted:#9aa4b2; --accent:#58a6ff; --accent-2:#1f6feb; --glass: rgba(255,255,255,0.03);
}
[data-theme="light"]{ --bg:#f5f7fa; --card:#ffffff; --muted:#5b6b78; --accent:#1a73e8; --accent-2:#1558b8; --glass: rgba(0,0,0,0.03); }
body{margin:0;background:var(--bg);font-family:Inter, sans-serif;color:#e6edf3;display:flex;justify-content:center;padding:16px;}
.app{width:100%;max-width:760px;}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);font-size:14px;background:var(--card);color:inherit;}
.theme-select{padding:10px;border-radius:10px;background:var(--card);color:inherit;border:1px solid rgba(255,255,255,0.08);}
.card{background:var(--card);padding:14px;border-radius:12px;}
.leaderboard{display:flex;flex-direction:column;gap:8px;margin-top:10px;}
.player{display:flex;justify-content:space-between;padding:10px;border-radius:10px;background:var(--glass);}
@media(max-width:600px){.topbar{flex-direction:column;gap:10px;}}
</style>
</head>
<body>
<div class="app">
    <div class="topbar">
        <div class="search"><input id="mainSearch" placeholder="Search players..." /></div>
        <select id="themeSelect" class="theme-select"><option value="auto">Auto</option><option value="dark">Dark</option><option value="light">Light</option></select>
    </div>

    <div class="card">
        <h3>Leaderboard</h3>
        <select id="charSelect" class="theme-select" style="margin-top:10px;margin-bottom:10px;">
            <option value="Nami">Nami</option>
            <option value="Pia">Pia</option>
            <option value="FREDDIE">FREDDIE</option>
        </select>
        <div id="leaderboardDiv" class="leaderboard"></div>
    </div>
</div>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbwOtTP8TgoM6URjfUNLqK0962-wRAP4IDHlKQApNvpov6dH7A7fxmrKSZ45hg_mKGBIaA/exec";
let mergedData = []; let allData = []; let themeMode = localStorage.getItem('ph_theme') || 'auto';
function applyTheme(mode){document.documentElement.setAttribute('data-theme', mode==='auto'?(window.matchMedia('(prefers-color-scheme: light)').matches?'light':'dark'):mode);} applyTheme(themeMode);
document.getElementById('themeSelect').value = themeMode;
document.getElementById('themeSelect').addEventListener('change', e=>{themeMode=e.target.value;localStorage.setItem('ph_theme',themeMode);applyTheme(themeMode);});
function numberFmt(n){return (Number(n)||0).toFixed(2);} function escapeHtml(s){return String(s).replace(/</g,'&lt;');}
async function fetchAll(){const chars=['Nami','Pia','FREDDIE']; const req=chars.map(c=>fetch(apiUrl+'?leaderboard='+c).then(r=>r.json()).catch(()=>[])); const res=await Promise.all(req);
 const flat=res.flatMap((arr,i)=>(arr||[]).map(p=>({id:p.id,name:p.name,hours:Number(p.hours),character:chars[i]}))); allData=flat;
 const map=new Map(); flat.forEach(p=>{if(!map.has(p.id)||p.hours>map.get(p.id).hours) map.set(p.id,p);}); mergedData=[...map.values()];}
function renderLeaderboard(char){const box=document.getElementById('leaderboardDiv'); box.innerHTML=''; const list=mergedData.filter(p=>p.character===char).sort((a,b)=>b.hours-a.hours).slice(0,10);
 list.forEach(p=>{const row=document.createElement('div'); row.className='player'; row.innerHTML=`<div>${escapeHtml(p.name)}<br><span style='font-size:12px;color:var(--muted)'>ID: ${escapeHtml(p.id)}</span></div><div>${numberFmt(p.hours)} hrs</div>`; box.appendChild(row);});}
function search(q){q=q.toLowerCase();const box=document.getElementById('leaderboardDiv');box.innerHTML=''; const list=allData.filter(p=>p.name.toLowerCase().includes(q)||p.id.toLowerCase().includes(q)).slice(0,20);
 list.forEach(p=>{const row=document.createElement('div'); row.className='player'; row.innerHTML=`<div>${escapeHtml(p.name)}<br><span style='font-size:12px;color:var(--muted)'>ID: ${escapeHtml(p.id)} • ${p.character}</span></div><div>${numberFmt(p.hours)} hrs</div>`; box.appendChild(row);});}

fetchAll().then(()=>renderLeaderboard('Nami'));

document.getElementById('charSelect').addEventListener('change', e=>renderLeaderboard(e.target.value));
document.getElementById('mainSearch').addEventListener('input', e=>search(e.target.value));
</script>
</body>
</html>
